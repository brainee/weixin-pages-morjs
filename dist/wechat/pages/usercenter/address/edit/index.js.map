{"version":3,"file":"pages/usercenter/address/edit/index.js","mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./pages/usercenter/address/edit/index.js"],"sourcesContent":["import { __assign, __spreadArray } from \"tslib\";\nimport Toast from 'tdesign-miniprogram/toast/index';\nimport { fetchDeliveryAddress } from '../../../../services/address/fetchAddress';\nimport { areaData } from '../../../../config/index';\nimport { resolveAddress, rejectAddress } from './util';\nvar innerPhoneReg = '^1(?:3\\\\d|4[4-9]|5[0-35-9]|6[67]|7[0-8]|8\\\\d|9\\\\d)\\\\d{8}$';\nvar innerNameReg = '^[a-zA-Z\\\\d\\\\u4e00-\\\\u9fa5]+$';\nvar labelsOptions = [\n    { id: 0, name: '家' },\n    { id: 1, name: '公司' },\n];\nPage({\n    options: {\n        multipleSlots: true,\n    },\n    externalClasses: ['theme-wrapper-class'],\n    data: {\n        locationState: {\n            labelIndex: null,\n            addressId: '',\n            addressTag: '',\n            cityCode: '',\n            cityName: '',\n            countryCode: '',\n            countryName: '',\n            detailAddress: '',\n            districtCode: '',\n            districtName: '',\n            isDefault: false,\n            name: '',\n            phone: '',\n            provinceCode: '',\n            provinceName: '',\n            isEdit: false,\n            isOrderDetail: false,\n            isOrderSure: false,\n        },\n        areaData: areaData,\n        labels: labelsOptions,\n        areaPickerVisible: false,\n        submitActive: false,\n        visible: false,\n        labelValue: '',\n        columns: 3,\n    },\n    privateData: {\n        verifyTips: '',\n    },\n    onLoad: function (options) {\n        var id = options.id;\n        this.init(id);\n    },\n    onUnload: function () {\n        if (!this.hasSava) {\n            rejectAddress();\n        }\n    },\n    hasSava: false,\n    init: function (id) {\n        if (id) {\n            this.getAddressDetail(Number(id));\n        }\n    },\n    getAddressDetail: function (id) {\n        var _this = this;\n        fetchDeliveryAddress(id).then(function (detail) {\n            _this.setData({ locationState: detail }, function () {\n                var _a = _this.onVerifyInputLegal(), isLegal = _a.isLegal, tips = _a.tips;\n                _this.setData({\n                    submitActive: isLegal,\n                });\n                _this.privateData.verifyTips = tips;\n            });\n        });\n    },\n    onInputValue: function (e) {\n        var _a;\n        var _this = this;\n        var item = e.currentTarget.dataset.item;\n        if (item === 'address') {\n            var _b = e.detail.selectedOptions, selectedOptions = _b === void 0 ? [] : _b;\n            this.setData({\n                'locationState.provinceCode': selectedOptions[0].value,\n                'locationState.provinceName': selectedOptions[0].label,\n                'locationState.cityName': selectedOptions[1].label,\n                'locationState.cityCode': selectedOptions[1].value,\n                'locationState.districtCode': selectedOptions[2].value,\n                'locationState.districtName': selectedOptions[2].label,\n                areaPickerVisible: false,\n            }, function () {\n                var _a = _this.onVerifyInputLegal(), isLegal = _a.isLegal, tips = _a.tips;\n                _this.setData({\n                    submitActive: isLegal,\n                });\n                _this.privateData.verifyTips = tips;\n            });\n        }\n        else {\n            var _c = e.detail.value, value = _c === void 0 ? '' : _c;\n            this.setData((_a = {},\n                _a[\"locationState.\" + item] = value,\n                _a), function () {\n                var _a = _this.onVerifyInputLegal(), isLegal = _a.isLegal, tips = _a.tips;\n                _this.setData({\n                    submitActive: isLegal,\n                });\n                _this.privateData.verifyTips = tips;\n            });\n        }\n    },\n    onPickArea: function () {\n        this.setData({ areaPickerVisible: true });\n    },\n    onPickLabels: function (e) {\n        var item = e.currentTarget.dataset.item;\n        var _a = this.data, _b = _a.locationState.labelIndex, labelIndex = _b === void 0 ? undefined : _b, _c = _a.labels, labels = _c === void 0 ? [] : _c;\n        var payload = {\n            labelIndex: item,\n            addressTag: labels[item].name,\n        };\n        if (item === labelIndex) {\n            payload = { labelIndex: null, addressTag: '' };\n        }\n        this.setData({\n            'locationState.labelIndex': payload.labelIndex,\n        });\n        this.triggerEvent('triggerUpdateValue', payload);\n    },\n    addLabels: function () {\n        this.setData({\n            visible: true,\n        });\n    },\n    confirmHandle: function () {\n        var _a = this.data, labels = _a.labels, labelValue = _a.labelValue;\n        this.setData({\n            visible: false,\n            labels: __spreadArray(__spreadArray([], labels, true), [{ id: labels[labels.length - 1].id + 1, name: labelValue }], false),\n            labelValue: '',\n        });\n    },\n    cancelHandle: function () {\n        this.setData({\n            visible: false,\n            labelValue: '',\n        });\n    },\n    onCheckDefaultAddress: function (_a) {\n        var detail = _a.detail;\n        var value = detail.value;\n        this.setData({\n            'locationState.isDefault': value,\n        });\n    },\n    onVerifyInputLegal: function () {\n        var _a = this.data.locationState, name = _a.name, phone = _a.phone, detailAddress = _a.detailAddress, districtName = _a.districtName;\n        var prefixPhoneReg = String(this.properties.phoneReg || innerPhoneReg);\n        var prefixNameReg = String(this.properties.nameReg || innerNameReg);\n        var nameRegExp = new RegExp(prefixNameReg);\n        var phoneRegExp = new RegExp(prefixPhoneReg);\n        if (!name || !name.trim()) {\n            return {\n                isLegal: false,\n                tips: '请填写收货人',\n            };\n        }\n        if (!nameRegExp.test(name)) {\n            return {\n                isLegal: false,\n                tips: '收货人仅支持输入中文、英文（区分大小写）、数字',\n            };\n        }\n        if (!phone || !phone.trim()) {\n            return {\n                isLegal: false,\n                tips: '请填写手机号',\n            };\n        }\n        if (!phoneRegExp.test(phone)) {\n            return {\n                isLegal: false,\n                tips: '请填写正确的手机号',\n            };\n        }\n        if (!districtName || !districtName.trim()) {\n            return {\n                isLegal: false,\n                tips: '请选择省市区信息',\n            };\n        }\n        if (!detailAddress || !detailAddress.trim()) {\n            return {\n                isLegal: false,\n                tips: '请完善详细地址',\n            };\n        }\n        if (detailAddress && detailAddress.trim().length > 50) {\n            return {\n                isLegal: false,\n                tips: '详细地址不能超过50个字符',\n            };\n        }\n        return {\n            isLegal: true,\n            tips: '添加成功',\n        };\n    },\n    builtInSearch: function (_a) {\n        var code = _a.code, name = _a.name;\n        return new Promise(function (resolve, reject) {\n            wx.getSetting({\n                success: function (res) {\n                    if (res.authSetting[code] === false) {\n                        wx.showModal({\n                            title: \"\\u83B7\\u53D6\" + name + \"\\u5931\\u8D25\",\n                            content: \"\\u83B7\\u53D6\" + name + \"\\u5931\\u8D25\\uFF0C\\u8BF7\\u5728\\u3010\\u53F3\\u4E0A\\u89D2\\u3011-\\u5C0F\\u7A0B\\u5E8F\\u3010\\u8BBE\\u7F6E\\u3011\\u9879\\u4E2D\\uFF0C\\u5C06\\u3010\" + name + \"\\u3011\\u5F00\\u542F\\u3002\",\n                            confirmText: '去设置',\n                            confirmColor: '#FA550F',\n                            cancelColor: '取消',\n                            success: function (res) {\n                                if (res.confirm) {\n                                    wx.openSetting({\n                                        success: function (settinRes) {\n                                            if (settinRes.authSetting[code] === true) {\n                                                resolve();\n                                            }\n                                            else {\n                                                console.warn('用户未打开权限', name, code);\n                                                reject();\n                                            }\n                                        },\n                                    });\n                                }\n                                else {\n                                    reject();\n                                }\n                            },\n                            fail: function () {\n                                reject();\n                            },\n                        });\n                    }\n                    else {\n                        resolve();\n                    }\n                },\n                fail: function () {\n                    reject();\n                },\n            });\n        });\n    },\n    onSearchAddress: function () {\n        var _this = this;\n        this.builtInSearch({ code: 'scope.userLocation', name: '地址位置' }).then(function () {\n            wx.chooseLocation({\n                success: function (res) {\n                    if (res.name) {\n                        _this.triggerEvent('addressParse', {\n                            address: res.address,\n                            name: res.name,\n                            latitude: res.latitude,\n                            longitude: res.longitude,\n                        });\n                    }\n                    else {\n                        Toast({\n                            context: _this,\n                            selector: '#t-toast',\n                            message: '地点为空，请重新选择',\n                            icon: '',\n                            duration: 1000,\n                        });\n                    }\n                },\n                fail: function (res) {\n                    console.warn(\"wx.chooseLocation fail: \" + JSON.stringify(res));\n                    if (res.errMsg !== 'chooseLocation:fail cancel') {\n                        Toast({\n                            context: this,\n                            selector: '#t-toast',\n                            message: '地点错误，请重新选择',\n                            icon: '',\n                            duration: 1000,\n                        });\n                    }\n                },\n            });\n        });\n    },\n    formSubmit: function () {\n        var submitActive = this.data.submitActive;\n        if (!submitActive) {\n            Toast({\n                context: this,\n                selector: '#t-toast',\n                message: this.privateData.verifyTips,\n                icon: '',\n                duration: 1000,\n            });\n            return;\n        }\n        var locationState = this.data.locationState;\n        this.hasSava = true;\n        resolveAddress({\n            saasId: '88888888',\n            uid: \"88888888205500\",\n            authToken: null,\n            id: locationState.addressId,\n            addressId: locationState.addressId,\n            phone: locationState.phone,\n            name: locationState.name,\n            countryName: locationState.countryName,\n            countryCode: locationState.countryCode,\n            provinceName: locationState.provinceName,\n            provinceCode: locationState.provinceCode,\n            cityName: locationState.cityName,\n            cityCode: locationState.cityCode,\n            districtName: locationState.districtName,\n            districtCode: locationState.districtCode,\n            detailAddress: locationState.detailAddress,\n            isDefault: locationState.isDefault === 1 ? 1 : 0,\n            addressTag: locationState.addressTag,\n            latitude: locationState.latitude,\n            longitude: locationState.longitude,\n            storeId: null,\n        });\n        wx.navigateBack({ delta: 1 });\n    },\n    getWeixinAddress: function (e) {\n        var _this = this;\n        var locationState = this.data.locationState;\n        var weixinAddress = e.detail;\n        this.setData({\n            locationState: __assign(__assign({}, locationState), weixinAddress),\n        }, function () {\n            var _a = _this.onVerifyInputLegal(), isLegal = _a.isLegal, tips = _a.tips;\n            _this.setData({\n                submitActive: isLegal,\n            });\n            _this.privateData.verifyTips = tips;\n        });\n    },\n});\n"],"names":[],"sourceRoot":""}